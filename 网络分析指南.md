## 网络分析指南

本节是谷歌开发者工具网络分析功能的全面参考，通过它可以探索新的方法来分析您的网页加载情况。

> 本节基于Chrome58

### 记录网络请求

默认情况，只要打开谷歌开发者工具，网络面板便会记录所有的网络请求。如图所示：

![](https://developers.google.cn/web/tools/chrome-devtools/network-performance/imgs/network.png)

#### 停止记录网络请求

- 点击停止记录网络请求摁钮![](https://developers.google.cn/web/tools/chrome-devtools/network-performance/imgs/record-on.png)，变灰色后表明开发者工具不在记录网络请求。

- 使用快捷键 Command+E(Mac) 或者 Ctrl+E(Windows)，前提是网络面板处于鼠标焦点

#### 清除网络请求

在网络面板上点击清除摁钮![](https://developers.google.cn/web/tools/chrome-devtools/network-performance/imgs/clear-requests.png)，会清除请求列表中的所有数据。

![](http://p1.bqimg.com/582863/cc403242848349bd.png)


#### 保留页面加载之间的网络请求

默认情况下，每次加载页面，谷歌开发者工具会清除上一次的所有请求信息。你可以通过点击**Perserve log**复选框，开启保留网络请求日志功能，开启后会一直保留捕获到的网络请求信息，页面加载时不清除，只到取消Perserve log功能。

![](http://p1.bqimg.com/582863/6b5d0028ad8e536b.png)

#### 捕获页面加载时的快照

通过捕获快照，可以直观看到页面加载的过程。点击开启捕获快照的摁钮![](https://developers.google.cn/web/tools/chrome-devtools/network-performance/imgs/capture-screenshots.png)，开启成功后，摁钮会变成蓝色，此时刷新重新加载页面。成功捕获快照后，可以通过如下方法查看：

    - 鼠标移动到捕获的快照上面，可以看到快照捕获在页面加载过程中对应的时刻(在总览上面会有一条黄色的竖直线)
    - 点击快照的缩略图，网络请求列表中会过滤出该快照对应时间段内的请求
    - 双击缩略图会放大显示
    
    ![](https://developers.google.cn/web/tools/chrome-devtools/network-performance/imgs/screenshot-hover.png)
    
#### 重发XHR请求

对于XHR类型的请求，在请求上右键，可以看到有**Replay XHR**选项，点击后，会重发该请求。如下图所示：

![](https://developers.google.cn/web/tools/chrome-devtools/network-performance/imgs/replay-xhr.png)

### 改变加载行为

#### 通过禁用缓存模拟第一次访问

浏览器会默认从本地加载缓存的资源。我们可以通过选择**Disable cache**复选框，禁用浏览器从缓存加载资源，更精确的模拟用户第一次访问页面的情形。

![](http://p1.bpimg.com/582863/38f45b3859b52eb6.png)

通过抽屉控制台中的**Network Conditions**标签页设置禁用缓存

如果你想在其它面板中，设置禁用缓存：

1. 打开抽屉控制台中的**Network Conditions**标签页
2. 勾选或者取消勾选禁用缓存选项

![](http://p1.bpimg.com/582863/24cbedd7a36876e5.png)

#### 手动清除浏览器缓存和Cookies

在网络请求列表中右击，选择**Clear Browser Cache**便可手动清除浏览器缓存。

同样，选择**Clear Browser Cookie**可以清楚浏览器的Cookies。

![](https://developers.google.cn/web/tools/chrome-devtools/network-performance/imgs/clear-browser-cache.png)

#### 模拟断网

有一类被称为[渐进式web应用](https://developers.google.cn/web/progressive-web-apps/)的web应用，它们能够利用[服务工作线程](https://developers.google.cn/web/fundamentals/getting-started/primers/service-workers)进行离线操作。当你调试这类应用时，使用模拟断网功能可以方便得仿真没有数据链接的设备。除些之外，还有很多场景需要我们模拟断网的场景。

如下图所示，勾选**Offline**复选框，会关闭网络链接，模拟断网的环境。

![](http://p1.bpimg.com/582863/1d6d0effbfbc9467.png)

#### 模拟弱网环境

如下图所示，通过网络限制菜单，可以模拟2G,3G以及其它网速环境。当网速限制开启后，在网络面板标签上，会显示一个警告的感叹号，提醒你当前网速限制被开启。

![](http://p1.bpimg.com/582863/b8ecc3a56080949c.png)

#### 重写用户代理字符串

    1. 如下图所示，打开抽屉控制台的**Network conditions**标签页。
    2. 可以看到**User agent**选项，取消**Select automatically**勾选。
    3. 选择谷歌开发者工具预置的用户代理，或者添加自定义的用户代理字符串。
    
    ![](http://i2.buimg.com/582863/3be96e5db32db1a1.png)

### 过滤请求

如何打开过滤功能，已在[网络](网络.md)中详细讲述，不会的可以回去查阅。

#### 通过属性过滤

如下图所示，在属性过滤输入框中输入想要过滤值，下面的请求列表仅显示过滤后请求。另外，属性过滤输入框支持多属性同时过滤，只需要用控制分隔即可，例如，```mime-type:image/gif larger-than:1K```会过滤出来所有大于1K的gif请求。这些用空格分隔的条件是与的关系，目前尚不支持或。

![](http://i2.buimg.com/582863/19aa6f22b1a3e930.png)

如下是支持过滤的部分属性，更多属性请参考[原文](https://developers.google.cn/web/tools/chrome-devtools/network-performance/reference#network-conditions?hl=en)：

    - domain  过滤指定domain的请求。支持```*```号通配符，例如```*.com```表示所有与.com结尾的domain
    - has-response-header 过滤具有指定HTTP响应头的请求
    - is is:runing过滤WebSocket请求
    - larger-than 过滤大于指定大小的请求，以字节为单位，1000可以简写为1K
    - method 过滤指定的HTTP method类型
    - mime-type 过滤指定MIME类型
    - mixed-content 过滤指定的混合内容。mixed-content:all 相当于不过滤。参考更多关于[混合内容](https://developers.google.cn/web/fundamentals/security/prevent-mixed-content/what-is-mixed-content?hl=en)的解释。
    -scheme scheme:http 过滤HTTP请求，scheme:https 过滤HTTPS
    
#### 通过类型过滤

如下图，点击相应类型便会过滤所选类型的请求。选择时，摁住Command(mac)/Ctrl(windows)可多选。

![](http://i1.piimg.com/582863/a424cf4a2962abfe.png)

#### 通过时间过滤

如下图所示，拖动网络总览窗口的时间范围条(红框中)，请求列表中会根据设置的时间范围过滤，仅显示设置时间范围内的请求。

![](http://i1.piimg.com/582863/25dddb0a6722d57b.png)

#### 隐藏 data URLs

![](http://i2.buimg.com/582863/204d82145f477849.png)
    


