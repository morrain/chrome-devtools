<!-- toc -->
## 分析运行时性能

运行时性能指的是页面运行时的状况，而并非页面加载时的状况。本节将介绍如何使用谷歌开发者工具的性能面板来分析运行时的性能。本节中提到的技巧，对于分析页面中的**响应**、**动画**以及**空闲**状态非常有用。更多信息请参考[RAIL模型](https://developers.google.com/web/fundamentals/performance/rail)

> 注意：本节基于Chrome 59版本，对于其它版本的Chrome ，开发者工具的UI界面可能会有所不同。

### 实例上手

通过如下实例，找到示例页面性能瓶颈。

1. 使用隐身模式打开谷歌浏览器。隐身模式能确保浏览器运行在一干净的状态，例如，如果你装了很多浏览器插件，这些插件可能会影响性能评估。
2. 打开如下网址：[https://googlechrome.github.io/devtools-samples/jank/](https://googlechrome.github.io/devtools-samples/jank/)，它是需要你根据教程实际上手剖析的示例，页面里有很多上下移动的蓝色方块。
3. 打开谷歌开发者工具

![](/assets/performance/get-started.png)

#### 模拟移动设备CPU

我们知道移动设备的CPU性能相比台式机和笔记本而言会弱很多，所以当你在分析一个页面时，可以使用CPU限制来模拟移动设备下页面的运行情况。

1. 切换到**性能**标签
2. 确保**快照**复选框被选中
3. 点击设置摁钮图标![](/assets/performance/capture-settings.png)。可以修改抓取性能指标相关的设置。
4. 在**CPU**选择框中选择**2*slowdown**。谷歌开发者工具会限制CPU比正常情况上慢2倍。

![](/assets/performance/throttling.png)

> 为了确保在低配的移动设备中，你的页面能正常工作，可以在CPU限制选项中选择**20*slowdown**选项。本示例为了教学目的，设置为2倍。

#### 设置demo

由于不同读者所处的环境不一样，所以很难使用统一的一个示例去演示运行时的性能，本节将通过定制demo中运动蓝色块的个数，来确保你体验到的运行时性能跟本节介绍的使用谷歌开发者工具中分析出来的相一致，从而消除掉不同环境下性能不一样带来的误差。

1. 连续点击示例中**Add 10**摁钮添加蓝色方块的数量，直到明显感觉到蓝色方块移动的速度比之间慢。在一般高配的机器上，大约需要点击20次。
2. 点击**Optimize**来优化运行时的性能，我们会发现蓝色块移动变快变平滑了。
3. 点击**Un-Optimize**取消优化，蓝色的方块又会变得慢并且卡顿了。

#### 录制运行时性能

为什么在优化模式下，蓝色方块会移动的更快？两种模式下，蓝色方块都是在同样的时间移动同样的距离。现在让我们在没有优化的模式下，利用性能面板，录制运行时的快照来分析瓶颈所在。

1. 点击**Record**![](/assets/performance/record.png)